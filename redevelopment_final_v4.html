<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ì¬ê°œë°œÂ·ì¬ê±´ì¶• ê³ ì‹œ ê³µê³ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <style>
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
            font-weight: 300;
        }
        
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-6Bold.woff') format('woff');
            font-weight: 600;
        }
        
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-4Regular.woff') format('woff');
            font-weight: 400;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'S-CoreDream', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        .info-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .info-label {
            font-weight: 600;
            color: #1e3c72;
            font-size: 13px;
        }
        
        .info-value input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'S-CoreDream', sans-serif;
            transition: all 0.3s;
        }
        
        .info-value input:focus {
            outline: none;
            border-color: #7e22ce;
            box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
        }
        
        .pages-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .page-counter {
            font-size: 15px;
            font-weight: 600;
            color: #1e3c72;
        }
        
        .page-buttons {
            display: flex;
            gap: 8px;
        }
        
        /* ë‹¤ì¤‘ ì—…ë¡œë“œ ì˜ì—­ */
        .multi-upload-zone {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border: 3px dashed #0ea5e9;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .multi-upload-zone:hover {
            background: linear-gradient(135deg, #bae6fd 0%, #7dd3fc 100%);
            border-color: #0284c7;
            transform: translateY(-2px);
        }
        
        .multi-upload-zone.dragover {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
            border-color: white;
            color: white;
        }
        
        .multi-upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .multi-upload-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #0c4a6e;
        }
        
        .multi-upload-zone.dragover .multi-upload-title {
            color: white;
        }
        
        .multi-upload-desc {
            font-size: 14px;
            color: #075985;
        }
        
        .multi-upload-zone.dragover .multi-upload-desc {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'S-CoreDream', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(126, 34, 206, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
        }
        
        .btn-add {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-remove {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        /* í¬ë¡­ ëª¨ë‹¬ */
        .crop-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .crop-modal.active {
            display: flex;
        }
        
        .crop-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }
        
        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .crop-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e3c72;
        }
        
        .crop-image-wrapper {
            max-width: 100%;
            max-height: 60vh;
            margin-bottom: 20px;
        }
        
        .crop-image-wrapper img {
            max-width: 100%;
            display: block;
        }
        
        .crop-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card-wrapper {
            margin-bottom: 15px;
            position: relative;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            padding: 30px 25px;
            position: relative;
            overflow: hidden;
        }
        
        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            animation: pulse 4s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }
        
        .card-header-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        
        .card-title {
            color: white;
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 0;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            letter-spacing: -1px;
            line-height: 1.2;
        }
        
        .card-body {
            padding: 25px;
        }
        
        .info-display {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 30px;
        }
        
        .info-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0;
            border-bottom: none;
        }
        
        .info-row-label {
            font-weight: 600;
            color: #1e3c72;
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: auto;
        }
        
        .info-row-value {
            color: #1e293b;
            font-size: 17px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 3px 10px;
            border-radius: 6px;
            font-weight: 600;
            display: inline-block;
        }
        
        .footer {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 0;
        }
        
        .footer-source {
            font-size: 15px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .footer-watermark {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* í˜ì´ì§€ ì•„ì´í…œ */
        .page-item {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .page-header {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .page-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .page-number {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            padding: 6px 16px;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .notice-image-container {
            position: relative;
            background: #f8fafc;
        }
        
        .canvas-wrapper {
            position: relative;
            display: none;
            width: 100%;
        }
        
        .canvas-wrapper.active {
            display: block;
        }
        
        .marking-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            z-index: 5;
            touch-action: none;
        }
        
        .notice-image {
            width: 100%;
            height: auto;
            display: block;
            min-height: 400px;
            object-fit: contain;
            background: white;
        }
        
        .image-upload-area {
            width: 100%;
            min-height: 400px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px dashed #cbd5e1;
        }
        
        .image-upload-area:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-color: #7e22ce;
        }
        
        .image-upload-area.dragover {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
            color: white;
            border-color: white;
        }
        
        .upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 20px;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .image-upload-area.dragover .upload-text {
            color: white;
        }
        
        .upload-subtext {
            font-size: 14px;
            color: #64748b;
        }
        
        .image-upload-area.dragover .upload-subtext {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .image-input {
            display: none;
        }
        
        /* ë§ˆí‚¹ ë„êµ¬ */
        .marking-tools {
            position: absolute;
            top: 15px;
            left: 15px;
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 10;
            gap: 8px;
            flex-wrap: wrap;
            max-width: calc(100% - 30px);
        }
        
        .marking-tools.active {
            display: flex;
        }
        
        .tool-btn {
            padding: 8px 14px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'S-CoreDream', sans-serif;
        }
        
        .tool-btn:hover {
            background: #f3f4f6;
        }
        
        .tool-btn.active {
            background: #7e22ce;
            color: white;
            border-color: #7e22ce;
        }
        
        .color-picker {
            width: 40px;
            height: 35px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .tool-divider {
            width: 2px;
            background: #e5e7eb;
            margin: 0 4px;
        }
        
        /* êµµê¸° ì„ íƒ ë“œë¡­ë‹¤ìš´ */
        .thickness-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .thickness-btn {
            padding: 8px 14px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            font-family: 'S-CoreDream', sans-serif;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .thickness-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 20;
            min-width: 120px;
        }
        
        .thickness-menu.active {
            display: block;
        }
        
        .thickness-option {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .thickness-option:hover {
            background: #f3f4f6;
        }
        
        .thickness-option.selected {
            background: #7e22ce;
            color: white;
        }
        
        .thickness-preview {
            width: 30px;
            height: 3px;
            background: #7e22ce;
            border-radius: 2px;
        }
        
        .thickness-option[data-thickness="thin"] .thickness-preview {
            height: 2px;
        }
        
        .thickness-option[data-thickness="normal"] .thickness-preview {
            height: 4px;
        }
        
        .thickness-option[data-thickness="thick"] .thickness-preview {
            height: 8px;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            z-index: 10;
            border: 2px solid white;
        }
        
        .remove-image-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .page-item.has-image .remove-image-btn {
            display: flex;
        }
        
        /* í˜ì´ì§€ ì‚­ì œ ë²„íŠ¼ */
        .delete-page-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            z-index: 15;
            border: 2px solid white;
        }
        
        .delete-page-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        /* ì²« í˜ì´ì§€ëŠ” ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€ */
        #page1Wrapper .delete-page-btn {
            display: none;
        }
        
        @media (max-width: 768px) {
            .card-title {
                font-size: 32px;
            }
            
            .info-display {
                grid-template-columns: 1fr;
            }
            
            .info-section {
                grid-template-columns: 1fr;
            }
            
            .crop-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <div class="info-section">
                <div class="info-item">
                    <label class="info-label"> ì§€ì—­</label>
                    <div class="info-value">
                        <input type="text" id="locationInput" placeholder="ì˜ˆ: ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬" value="ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬">
                    </div>
                </div>
                <div class="info-item">
                    <label class="info-label"> ì‚¬ì—…ëª…</label>
                    <div class="info-value">
                        <input type="text" id="projectInput" placeholder="ì˜ˆ: ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…" value="ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…">
                    </div>
                </div>
                <div class="info-item">
                    <label class="info-label"> ê³ ì‹œì¼</label>
                    <div class="info-value">
                        <input type="text" id="dateInput" placeholder="ì˜ˆ: 2025ë…„ 11ì›” 16ì¼" value="2025ë…„ 11ì›” 16ì¼">
                    </div>
                </div>
                <div class="info-item">
                    <label class="info-label"> êµ¬ë¶„</label>
                    <div class="info-value">
                        <input type="text" id="typeInput" placeholder="ì¬ê°œë°œ/ì¬ê±´ì¶•" value="ì¬ê°œë°œ">
                    </div>
                </div>
            </div>
            
            <!-- ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
            <div class="multi-upload-zone" id="multiUploadZone">
                <input type="file" id="multiImageInput" accept="image/*" multiple style="display: none;">
                <div class="multi-upload-icon">ğŸ“š</div>
                <div class="multi-upload-title">ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ í•œë²ˆì— ì—…ë¡œë“œ</div>
                <div class="multi-upload-desc">í´ë¦­í•˜ê±°ë‚˜ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì„¸ìš” (ìë™ìœ¼ë¡œ í˜ì´ì§€ ì¶”ê°€)</div>
            </div>
            
            <div class="pages-control">
                <div class="page-counter">ì´ <strong id="pageCount">0</strong>ê°œ í˜ì´ì§€</div>
                <div class="page-buttons">
                    <button class="btn btn-add btn-small" onclick="addPage()">â• í˜ì´ì§€ ì¶”ê°€</button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveAllPages()">ğŸ’¾ ëª¨ë“  í˜ì´ì§€ ì €ì¥</button>
                <button class="btn btn-secondary" onclick="resetAll()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
        </div>
        
        <!-- 1í˜ì´ì§€ -->
        <div class="card-wrapper" id="page1Wrapper">
            <button class="delete-page-btn" onclick="deletePage(1)">âœ•</button>
            <div class="card" id="page1Card">
                <div class="card-header">
                    <div class="card-header-content">
                        <h1 class="card-title"> ë¶€ì‚° ì¬ê°œë°œÂ·ì¬ê±´ì¶• ê³ ì‹œ ê³µê³ </h1>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="info-display">
                        <div class="info-row">
                            <div class="info-row-label"> ì§€ì—­</div>
                            <div class="info-row-value" id="displayLocation">ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬</div>
                        </div>
                        <div class="info-row">
                            <div class="info-row-label"> ì‚¬ì—…ëª…</div>
                            <div class="info-row-value" id="displayProject">ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…</div>
                        </div>
                        <div class="info-row">
                            <div class="info-row-label"> ê³ ì‹œì¼</div>
                            <div class="info-row-value" id="displayDate">2025ë…„ 11ì›” 16ì¼</div>
                        </div>
                        <div class="info-row">
                            <div class="info-row-label"> êµ¬ë¶„</div>
                            <div class="info-row-value">
                                <span class="highlight-box" id="displayType">ì¬ê°œë°œ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="page-item" id="page1" data-page="1">
                        <div class="page-header">
                            <div class="page-title">
                                <span>ğŸ“„</span>
                                <span>ê³ ì‹œê³µê³ ë¬¸ 1í˜ì´ì§€</span>
                            </div>
                            <div class="page-number">1 / 1</div>
                        </div>
                        <div class="notice-image-container">
                            <input type="file" class="image-input" id="imageInput1" accept="image/*">
                            <div class="image-upload-area" onclick="document.getElementById('imageInput1').click()">
                                <div class="upload-icon">ğŸ“„</div>
                                <div class="upload-text">1í˜ì´ì§€ ì´ë¯¸ì§€ ì²¨ë¶€</div>
                                <div class="upload-subtext">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                            </div>
                            <div class="canvas-wrapper">
                                <img class="notice-image">
                                <canvas class="marking-canvas"></canvas>
                            </div>
                            <div class="marking-tools">
                                <button class="tool-btn" onclick="showCropModal(1)">âœ‚ï¸ ìë¥´ê¸°</button>
                                <div class="tool-divider"></div>
                                <button class="tool-btn active" onclick="setTool(1, 'select')" data-tool="select">ğŸ‘† ì„ íƒ</button>
                                <button class="tool-btn" onclick="setTool(1, 'pen')" data-tool="pen">âœï¸ íœ</button>
                                <button class="tool-btn" onclick="setTool(1, 'highlight')" data-tool="highlight">âœï¸ í˜•ê´‘íœ</button>
                                <div class="thickness-dropdown">
                                    <button class="thickness-btn" onclick="toggleThickness(1)">
                                        ğŸ“ êµµê¸° <span id="thicknessLabel1">ë³´í†µ</span>
                                    </button>
                                    <div class="thickness-menu" id="thicknessMenu1">
                                        <div class="thickness-option" data-thickness="thin" onclick="setThickness(1, 'thin', 'ì–‡ê²Œ')">
                                            <div class="thickness-preview"></div>
                                            <span>ì–‡ê²Œ</span>
                                        </div>
                                        <div class="thickness-option selected" data-thickness="normal" onclick="setThickness(1, 'normal', 'ë³´í†µ')">
                                            <div class="thickness-preview"></div>
                                            <span>ë³´í†µ</span>
                                        </div>
                                        <div class="thickness-option" data-thickness="thick" onclick="setThickness(1, 'thick', 'êµµê²Œ')">
                                            <div class="thickness-preview"></div>
                                            <span>êµµê²Œ</span>
                                        </div>
                                    </div>
                                </div>
                                <button class="tool-btn" onclick="setTool(1, 'circle')" data-tool="circle">â­• ë™ê·¸ë¼ë¯¸</button>
                                <button class="tool-btn" onclick="setTool(1, 'arrow')" data-tool="arrow">â¡ï¸ í™”ì‚´í‘œ</button>
                                <button class="tool-btn" onclick="setTool(1, 'rect')" data-tool="rect">â–­ ì‚¬ê°í˜•</button>
                                <button class="tool-btn" onclick="setTool(1, 'map')" data-tool="map">ğŸ—ºï¸ ì§€ë„</button>
                                <div class="tool-divider"></div>
                                <input type="color" class="color-picker" value="#ffff00" onchange="setColor(1, this.value)">
                                <button class="tool-btn" onclick="deleteSelected(1)">ğŸ—‘ï¸ ì‚­ì œ</button>
                                <button class="tool-btn" onclick="clearMarks(1)">ğŸ—‘ï¸ ì „ì²´ì‚­ì œ</button>
                            </div>
                            <button class="remove-image-btn" onclick="removeImage(1)">âœ•</button>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <div class="footer-source"> ì¶œì²˜: @Chok.sense1</div>
                        <div class="footer-watermark">ë¶€ì‚° ì¬ê°œë°œÂ·ì¬ê±´ì¶• ì‹ ì† ì•Œë¦¼</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="additionalPages"></div>
    </div>
    
    <!-- í¬ë¡­ ëª¨ë‹¬ -->
    <div class="crop-modal" id="cropModal">
        <div class="crop-container">
            <div class="crop-header">
                <div class="crop-title">âœ‚ï¸ ì´ë¯¸ì§€ ìë¥´ê¸°</div>
            </div>
            <div class="crop-image-wrapper">
                <img id="cropImage">
            </div>
            <div class="crop-actions">
                <button class="btn btn-primary" onclick="applyCrop()">âœ“ ì ìš©</button>
                <button class="btn btn-secondary" onclick="cancelCrop()">âœ• ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        let pageCount = 1;
        const MAX_PAGES = 20;
        const markingStates = {};
        let currentCropPage = null;
        let cropper = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            setupPage(1);
            updateInputListeners();
            loadSavedData();
            updatePageCounter();
            setupMultiUpload();
            
            // êµµê¸° ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.thickness-dropdown')) {
                    document.querySelectorAll('.thickness-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                }
            });
        });
        
        // ë‹¤ì¤‘ ì—…ë¡œë“œ ì„¤ì •
        function setupMultiUpload() {
            const zone = document.getElementById('multiUploadZone');
            const input = document.getElementById('multiImageInput');
            
            zone.addEventListener('click', () => input.click());
            
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('dragover');
            });
            
            zone.addEventListener('dragleave', () => {
                zone.classList.remove('dragover');
            });
            
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('dragover');
                handleMultipleFiles(e.dataTransfer.files);
            });
            
            input.addEventListener('change', (e) => {
                handleMultipleFiles(e.target.files);
                input.value = ''; // ì´ˆê¸°í™”
            });
        }
        
        // ë‹¤ì¤‘ íŒŒì¼ ì²˜ë¦¬
        function handleMultipleFiles(files) {
            const imageFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (imageFiles.length > MAX_PAGES) {
                alert(`ìµœëŒ€ ${MAX_PAGES}ê°œ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                imageFiles.length = MAX_PAGES;
            }
            
            // ì²« í˜ì´ì§€ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì²« í˜ì´ì§€ë¶€í„°, ì•„ë‹ˆë©´ ìƒˆ í˜ì´ì§€ ì¶”ê°€
            let startPage = 1;
            const firstPage = document.getElementById('page1');
            const hasImage = firstPage && firstPage.classList.contains('has-image');
            
            if (hasImage) {
                startPage = pageCount + 1;
            }
            
            // í•„ìš”í•œ ë§Œí¼ í˜ì´ì§€ ì¶”ê°€
            const pagesNeeded = hasImage ? imageFiles.length : imageFiles.length - 1;
            for (let i = 0; i < pagesNeeded; i++) {
                if (pageCount < MAX_PAGES) {
                    addPage();
                }
            }
            
            // ê° ì´ë¯¸ì§€ë¥¼ í˜ì´ì§€ì— í• ë‹¹
            imageFiles.forEach((file, index) => {
                const pageNum = hasImage ? startPage + index : 1 + index;
                
                setTimeout(() => {
                    const pageItem = document.getElementById(`page${pageNum}`);
                    if (!pageItem) return;
                    
                    const uploadArea = pageItem.querySelector('.image-upload-area');
                    const canvasWrapper = pageItem.querySelector('.canvas-wrapper');
                    const img = canvasWrapper.querySelector('.notice-image');
                    const canvas = canvasWrapper.querySelector('.marking-canvas');
                    
                    handleImageUpload(file, uploadArea, canvasWrapper, img, canvas, pageItem, pageNum);
                }, index * 100); // ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
            });
            
            setTimeout(() => {
                alert(`${imageFiles.length}ê°œ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
            }, imageFiles.length * 100 + 200);
        }
        
        function updateInputListeners() {
            const inputs = {
                locationInput: 'displayLocation',
                projectInput: 'displayProject',
                dateInput: 'displayDate',
                typeInput: 'displayType'
            };
            
            Object.keys(inputs).forEach(inputId => {
                const input = document.getElementById(inputId);
                const display = document.getElementById(inputs[inputId]);
                
                input.addEventListener('input', function() {
                    const value = input.value || '[ì…ë ¥ í•„ìš”]';
                    display.textContent = value;
                    
                    for (let i = 2; i <= pageCount; i++) {
                        const pageDisplay = document.getElementById(inputs[inputId] + i);
                        if (pageDisplay) {
                            pageDisplay.textContent = value;
                        }
                    }
                    
                    localStorage.setItem(inputId, input.value);
                });
            });
        }
        
        function updateDisplayValues(pageNum) {
            const values = {
                displayLocation: document.getElementById('locationInput').value,
                displayProject: document.getElementById('projectInput').value,
                displayDate: document.getElementById('dateInput').value,
                displayType: document.getElementById('typeInput').value
            };
            
            Object.keys(values).forEach(key => {
                const element = document.getElementById(key + pageNum);
                if (element) {
                    element.textContent = values[key];
                }
            });
        }
        
        function setupPage(pageNum) {
            const input = document.getElementById(`imageInput${pageNum}`);
            if (!input) return;
            
            const uploadArea = input.nextElementSibling;
            const canvasWrapper = uploadArea.nextElementSibling;
            const img = canvasWrapper.querySelector('.notice-image');
            const canvas = canvasWrapper.querySelector('.marking-canvas');
            const pageItem = document.getElementById(`page${pageNum}`);
            
            markingStates[pageNum] = {
                tool: 'select',
                color: '#ffff00',
                thickness: 'normal',
                isDrawing: false,
                isDragging: false,
                startX: 0,
                startY: 0,
                drawings: [],
                selectedIndex: -1,
                dragOffsetX: 0,
                dragOffsetY: 0,
                originalImage: null,
                penPath: []
            };
            
            input.addEventListener('change', function(e) {
                handleImageUpload(e.target.files[0], uploadArea, canvasWrapper, img, canvas, pageItem, pageNum);
            });
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleImageUpload(e.dataTransfer.files[0], uploadArea, canvasWrapper, img, canvas, pageItem, pageNum);
            });
        }
        
        function handleImageUpload(file, uploadArea, canvasWrapper, img, canvas, pageItem, pageNum) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    markingStates[pageNum].originalImage = e.target.result;
                    img.src = e.target.result;
                    img.onload = function() {
                        uploadArea.style.display = 'none';
                        canvasWrapper.classList.add('active');
                        pageItem.classList.add('has-image');
                        
                        const rect = img.getBoundingClientRect();
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        canvas.style.width = rect.width + 'px';
                        canvas.style.height = rect.height + 'px';
                        
                        const tools = pageItem.querySelector('.marking-tools');
                        tools.classList.add('active');
                        
                        setupCanvas(canvas, pageNum);
                    };
                };
                reader.readAsDataURL(file);
            }
        }
        
        function getThicknessValue(thickness, tool) {
            const values = {
                'pen': { thin: 2, normal: 4, thick: 8 },
                'highlight': { thin: 15, normal: 25, thick: 40 },
                'default': { thin: 2, normal: 4, thick: 6 }
            };
            
            const toolValues = values[tool] || values['default'];
            return toolValues[thickness] || toolValues['normal'];
        }
        
        function setupCanvas(canvas, pageNum) {
            const ctx = canvas.getContext('2d');
            const state = markingStates[pageNum];
            
            function getCanvasCoords(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }
            
            function getClickedShape(x, y) {
                for (let i = state.drawings.length - 1; i >= 0; i--) {
                    const drawing = state.drawings[i];
                    if (isPointInShape(x, y, drawing)) {
                        return i;
                    }
                }
                return -1;
            }
            
            function isPointInShape(x, y, drawing) {
                const tolerance = 15;
                
                if (drawing.tool === 'pen') {
                    for (let i = 0; i < drawing.path.length - 1; i++) {
                        const dist = distanceToLine(x, y, drawing.path[i].x, drawing.path[i].y, 
                                                    drawing.path[i+1].x, drawing.path[i+1].y);
                        if (dist < tolerance + 5) return true;
                    }
                    return false;
                } else if (drawing.tool === 'highlight') {
                    const dist = distanceToLine(x, y, drawing.startX, drawing.startY, drawing.endX, drawing.endY);
                    return dist < tolerance + 10;
                } else if (drawing.tool === 'circle') {
                    const radius = Math.sqrt(Math.pow(drawing.endX - drawing.startX, 2) + Math.pow(drawing.endY - drawing.startY, 2));
                    const dist = Math.sqrt(Math.pow(x - drawing.startX, 2) + Math.pow(y - drawing.startY, 2));
                    return Math.abs(dist - radius) < tolerance;
                } else if (drawing.tool === 'rect' || drawing.tool === 'map') {
                    const minX = Math.min(drawing.startX, drawing.endX);
                    const maxX = Math.max(drawing.startX, drawing.endX);
                    const minY = Math.min(drawing.startY, drawing.endY);
                    const maxY = Math.max(drawing.startY, drawing.endY);
                    return x >= minX - tolerance && x <= maxX + tolerance && 
                           y >= minY - tolerance && y <= maxY + tolerance;
                } else if (drawing.tool === 'arrow') {
                    const dist = distanceToLine(x, y, drawing.startX, drawing.startY, drawing.endX, drawing.endY);
                    return dist < tolerance;
                }
                return false;
            }
            
            function distanceToLine(px, py, x1, y1, x2, y2) {
                const A = px - x1;
                const B = py - y1;
                const C = x2 - x1;
                const D = y2 - y1;
                
                const dot = A * C + B * D;
                const lenSq = C * C + D * D;
                let param = -1;
                
                if (lenSq != 0) param = dot / lenSq;
                
                let xx, yy;
                
                if (param < 0) {
                    xx = x1;
                    yy = y1;
                } else if (param > 1) {
                    xx = x2;
                    yy = y2;
                } else {
                    xx = x1 + param * C;
                    yy = y1 + param * D;
                }
                
                const dx = px - xx;
                const dy = py - yy;
                return Math.sqrt(dx * dx + dy * dy);
            }
            
            canvas.addEventListener('mousedown', (e) => {
                const coords = getCanvasCoords(e);
                const x = coords.x;
                const y = coords.y;
                
                if (state.tool === 'select') {
                    const clickedIndex = getClickedShape(x, y);
                    if (clickedIndex !== -1) {
                        state.selectedIndex = clickedIndex;
                        state.isDragging = true;
                        const drawing = state.drawings[clickedIndex];
                        
                        if (drawing.tool === 'pen') {
                            state.dragOffsetX = x - drawing.path[0].x;
                            state.dragOffsetY = y - drawing.path[0].y;
                        } else {
                            state.dragOffsetX = x - drawing.startX;
                            state.dragOffsetY = y - drawing.startY;
                        }
                        canvas.style.cursor = 'move';
                    } else {
                        state.selectedIndex = -1;
                    }
                    redrawCanvas(canvas, pageNum);
                } else if (state.tool === 'pen') {
                    state.isDrawing = true;
                    state.penPath = [{x, y}];
                } else {
                    state.isDrawing = true;
                    state.startX = x;
                    state.startY = y;
                }
            });
            
            canvas.addEventListener('mousemove', (e) => {
                const coords = getCanvasCoords(e);
                const x = coords.x;
                const y = coords.y;
                
                if (state.tool === 'select' && state.isDragging && state.selectedIndex !== -1) {
                    const drawing = state.drawings[state.selectedIndex];
                    
                    if (drawing.tool === 'pen') {
                        const dx = x - state.dragOffsetX - drawing.path[0].x;
                        const dy = y - state.dragOffsetY - drawing.path[0].y;
                        
                        drawing.path.forEach(point => {
                            point.x += dx;
                            point.y += dy;
                        });
                    } else {
                        const dx = x - state.dragOffsetX - drawing.startX;
                        const dy = y - state.dragOffsetY - drawing.startY;
                        
                        drawing.startX += dx;
                        drawing.startY += dy;
                        drawing.endX += dx;
                        drawing.endY += dy;
                    }
                    
                    redrawCanvas(canvas, pageNum);
                } else if (state.isDrawing) {
                    if (state.tool === 'pen') {
                        state.penPath.push({x, y});
                    }
                    redrawCanvas(canvas, pageNum);
                    if (state.tool === 'pen') {
                        drawPenPath(ctx, state.penPath, state.color, state.thickness, true);
                    } else {
                        drawShape(ctx, state.tool, state.startX, state.startY, x, y, state.color, state.thickness, true);
                    }
                } else if (state.tool === 'select') {
                    const hoverIndex = getClickedShape(x, y);
                    canvas.style.cursor = hoverIndex !== -1 ? 'pointer' : 'default';
                }
            });
            
            canvas.addEventListener('mouseup', (e) => {
                if (state.isDragging) {
                    state.isDragging = false;
                    canvas.style.cursor = 'default';
                } else if (state.isDrawing) {
                    const coords = getCanvasCoords(e);
                    const x = coords.x;
                    const y = coords.y;
                    
                    if (state.tool === 'pen' && state.penPath.length > 1) {
                        state.drawings.push({
                            tool: 'pen',
                            path: [...state.penPath],
                            color: state.color,
                            thickness: state.thickness
                        });
                        state.penPath = [];
                    } else if (state.tool !== 'pen') {
                        state.drawings.push({
                            tool: state.tool,
                            startX: state.startX,
                            startY: state.startY,
                            endX: x,
                            endY: y,
                            color: state.color,
                            thickness: state.thickness
                        });
                    }
                    
                    state.isDrawing = false;
                    redrawCanvas(canvas, pageNum);
                }
            });
            
            canvas.addEventListener('mouseleave', () => {
                if (state.isDrawing) {
                    state.isDrawing = false;
                    state.penPath = [];
                    redrawCanvas(canvas, pageNum);
                }
                if (state.isDragging) {
                    state.isDragging = false;
                    canvas.style.cursor = 'default';
                }
            });
        }
        
        function drawPenPath(ctx, path, color, thickness, isPreview = false) {
            if (path.length < 2) return;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = getThicknessValue(thickness, 'pen');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.beginPath();
            ctx.moveTo(path[0].x, path[0].y);
            
            for (let i = 1; i < path.length; i++) {
                ctx.lineTo(path[i].x, path[i].y);
            }
            
            ctx.stroke();
        }
        
        function drawShape(ctx, tool, x1, y1, x2, y2, color, thickness, isPreview = false, isSelected = false) {
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            
            if (tool === 'highlight') {
                ctx.lineWidth = getThicknessValue(thickness, 'highlight');
            } else if (tool === 'map') {
                ctx.lineWidth = 3;
            } else {
                ctx.lineWidth = getThicknessValue(thickness, 'default');
            }
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            if (isSelected) {
                ctx.strokeStyle = '#0080ff';
                ctx.lineWidth += 2;
            }
            
            if (tool === 'highlight') {
                ctx.globalAlpha = 0.4;
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                ctx.globalAlpha = 1;
            } else if (tool === 'circle') {
                const radius = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                ctx.beginPath();
                ctx.arc(x1, y1, radius, 0, 2 * Math.PI);
                ctx.stroke();
            } else if (tool === 'rect') {
                ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
            } else if (tool === 'map') {
                ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
                
                ctx.globalAlpha = 0.3;
                ctx.lineWidth = 1;
                const gridSize = 4;
                const width = x2 - x1;
                const height = y2 - y1;
                
                for (let i = 1; i < gridSize; i++) {
                    const gx = x1 + (width / gridSize) * i;
                    ctx.beginPath();
                    ctx.moveTo(gx, y1);
                    ctx.lineTo(gx, y2);
                    ctx.stroke();
                }
                
                for (let i = 1; i < gridSize; i++) {
                    const gy = y1 + (height / gridSize) * i;
                    ctx.beginPath();
                    ctx.moveTo(x1, gy);
                    ctx.lineTo(x2, gy);
                    ctx.stroke();
                }
                
                ctx.globalAlpha = 1;
            } else if (tool === 'arrow') {
                drawArrow(ctx, x1, y1, x2, y2);
            }
        }
        
        function drawArrow(ctx, x1, y1, x2, y2) {
            const headlen = 15;
            const angle = Math.atan2(y2 - y1, x2 - x1);
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x2 - headlen * Math.cos(angle - Math.PI / 6), y2 - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headlen * Math.cos(angle + Math.PI / 6), y2 - headlen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }
        
        function redrawCanvas(canvas, pageNum) {
            const ctx = canvas.getContext('2d');
            const state = markingStates[pageNum];
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            state.drawings.forEach((drawing, index) => {
                const isSelected = (index === state.selectedIndex);
                
                if (drawing.tool === 'pen') {
                    drawPenPath(ctx, drawing.path, drawing.color, drawing.thickness);
                } else {
                    drawShape(ctx, drawing.tool, drawing.startX, drawing.startY, drawing.endX, drawing.endY, 
                             drawing.color, drawing.thickness, false, isSelected);
                }
            });
        }
        
        function setTool(pageNum, tool) {
            markingStates[pageNum].tool = tool;
            markingStates[pageNum].selectedIndex = -1;
            const pageItem = document.getElementById(`page${pageNum}`);
            const buttons = pageItem.querySelectorAll('.tool-btn[data-tool]');
            buttons.forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tool') === tool);
            });
            
            const canvas = pageItem.querySelector('.marking-canvas');
            redrawCanvas(canvas, pageNum);
        }
        
        function setColor(pageNum, color) {
            markingStates[pageNum].color = color;
        }
        
        function toggleThickness(pageNum) {
            event.stopPropagation();
            const menu = document.getElementById(`thicknessMenu${pageNum}`);
            
            document.querySelectorAll('.thickness-menu').forEach(m => {
                if (m !== menu) m.classList.remove('active');
            });
            
            menu.classList.toggle('active');
        }
        
        function setThickness(pageNum, thickness, label) {
            event.stopPropagation();
            markingStates[pageNum].thickness = thickness;
            
            document.getElementById(`thicknessLabel${pageNum}`).textContent = label;
            
            const menu = document.getElementById(`thicknessMenu${pageNum}`);
            menu.querySelectorAll('.thickness-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.thickness === thickness);
            });
            
            menu.classList.remove('active');
        }
        
        function deleteSelected(pageNum) {
            const state = markingStates[pageNum];
            if (state.selectedIndex !== -1) {
                state.drawings.splice(state.selectedIndex, 1);
                state.selectedIndex = -1;
                const pageItem = document.getElementById(`page${pageNum}`);
                const canvas = pageItem.querySelector('.marking-canvas');
                redrawCanvas(canvas, pageNum);
            }
        }
        
        function clearMarks(pageNum) {
            markingStates[pageNum].drawings = [];
            markingStates[pageNum].selectedIndex = -1;
            const pageItem = document.getElementById(`page${pageNum}`);
            const canvas = pageItem.querySelector('.marking-canvas');
            redrawCanvas(canvas, pageNum);
        }
        
        function showCropModal(pageNum) {
            currentCropPage = pageNum;
            const state = markingStates[pageNum];
            
            if (!state.originalImage) {
                alert('ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const cropImage = document.getElementById('cropImage');
            cropImage.src = state.originalImage;
            
            document.getElementById('cropModal').classList.add('active');
            
            if (cropper) {
                cropper.destroy();
            }
            
            cropImage.onload = function() {
                cropper = new Cropper(cropImage, {
                    aspectRatio: NaN,
                    viewMode: 1,
                    dragMode: 'move',
                    autoCropArea: 0.8,
                    restore: false,
                    guides: true,
                    center: true,
                    highlight: true,
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    toggleDragModeOnDblclick: false,
                });
            };
        }
        
        function applyCrop() {
            if (!cropper || !currentCropPage) return;
            
            const canvas = cropper.getCroppedCanvas();
            const croppedImage = canvas.toDataURL();
            
            const pageItem = document.getElementById(`page${currentCropPage}`);
            const img = pageItem.querySelector('.notice-image');
            const markingCanvas = pageItem.querySelector('.marking-canvas');
            
            img.src = croppedImage;
            img.onload = function() {
                const rect = img.getBoundingClientRect();
                markingCanvas.width = img.naturalWidth;
                markingCanvas.height = img.naturalHeight;
                markingCanvas.style.width = rect.width + 'px';
                markingCanvas.style.height = rect.height + 'px';
                
                markingStates[currentCropPage].drawings = [];
                markingStates[currentCropPage].selectedIndex = -1;
                redrawCanvas(markingCanvas, currentCropPage);
            };
            
            cancelCrop();
        }
        
        function cancelCrop() {
            document.getElementById('cropModal').classList.remove('active');
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
            currentCropPage = null;
        }
        
        function removeImage(pageNum) {
            const pageItem = document.getElementById(`page${pageNum}`);
            const input = document.getElementById(`imageInput${pageNum}`);
            const uploadArea = pageItem.querySelector('.image-upload-area');
            const canvasWrapper = pageItem.querySelector('.canvas-wrapper');
            const img = canvasWrapper.querySelector('.notice-image');
            const canvas = canvasWrapper.querySelector('.marking-canvas');
            const tools = pageItem.querySelector('.marking-tools');
            
            img.src = '';
            canvasWrapper.classList.remove('active');
            uploadArea.style.display = 'flex';
            input.value = '';
            pageItem.classList.remove('has-image');
            tools.classList.remove('active');
            
            if (markingStates[pageNum]) {
                markingStates[pageNum].drawings = [];
                markingStates[pageNum].selectedIndex = -1;
                markingStates[pageNum].originalImage = null;
                markingStates[pageNum].penPath = [];
            }
        }
        
        // í˜ì´ì§€ ì‚­ì œ ê¸°ëŠ¥
        function deletePage(pageNum) {
            if (pageNum === 1) {
                alert('1í˜ì´ì§€ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`${pageNum}í˜ì´ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const pageWrapper = document.getElementById(`page${pageNum}Wrapper`);
            if (pageWrapper) {
                pageWrapper.remove();
                delete markingStates[pageNum];
                
                // í˜ì´ì§€ ë²ˆí˜¸ ì¬ì •ë ¬
                renumberPages();
            }
        }
        
        // í˜ì´ì§€ ë²ˆí˜¸ ì¬ì •ë ¬
        function renumberPages() {
            const allWrappers = document.querySelectorAll('.card-wrapper');
            pageCount = allWrappers.length;
            
            allWrappers.forEach((wrapper, index) => {
                const newPageNum = index + 1;
                const oldPageNum = parseInt(wrapper.id.replace('pageWrapper', '').replace('page', ''));
                
                if (oldPageNum !== newPageNum) {
                    // ID ë³€ê²½
                    wrapper.id = `page${newPageNum}Wrapper`;
                    const card = wrapper.querySelector('.card');
                    card.id = `page${newPageNum}Card`;
                    
                    const pageItem = wrapper.querySelector('.page-item');
                    pageItem.id = `page${newPageNum}`;
                    pageItem.setAttribute('data-page', newPageNum);
                    
                    // ì…ë ¥ ìš”ì†Œ ID ë³€ê²½
                    const input = wrapper.querySelector('.image-input');
                    input.id = `imageInput${newPageNum}`;
                    
                    // ì—…ë¡œë“œ ì˜ì—­ onclick ë³€ê²½
                    const uploadArea = wrapper.querySelector('.image-upload-area');
                    uploadArea.setAttribute('onclick', `document.getElementById('imageInput${newPageNum}').click()`);
                    
                    // í˜ì´ì§€ ì œëª© ë³€ê²½
                    const pageTitle = wrapper.querySelector('.page-title span:last-child');
                    pageTitle.textContent = `ê³ ì‹œê³µê³ ë¬¸ ${newPageNum}í˜ì´ì§€`;
                    
                    // í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ ë³€ê²½
                    const pageNumber = wrapper.querySelector('.page-number');
                    pageNumber.textContent = `${newPageNum} / ${pageCount}`;
                    
                    // ì—…ë¡œë“œ í…ìŠ¤íŠ¸ ë³€ê²½
                    const uploadText = wrapper.querySelector('.upload-text');
                    uploadText.textContent = `${newPageNum}í˜ì´ì§€ ì´ë¯¸ì§€ ì²¨ë¶€`;
                    
                    // ë„êµ¬ ë²„íŠ¼ë“¤ onclick ë³€ê²½
                    wrapper.querySelectorAll('[onclick]').forEach(btn => {
                        const onclick = btn.getAttribute('onclick');
                        if (onclick) {
                            btn.setAttribute('onclick', onclick.replace(/\d+/g, newPageNum));
                        }
                    });
                    
                    // êµµê¸° ê´€ë ¨ ID ë³€ê²½
                    const thicknessLabel = wrapper.querySelector('[id^="thicknessLabel"]');
                    if (thicknessLabel) thicknessLabel.id = `thicknessLabel${newPageNum}`;
                    
                    const thicknessMenu = wrapper.querySelector('[id^="thicknessMenu"]');
                    if (thicknessMenu) thicknessMenu.id = `thicknessMenu${newPageNum}`;
                    
                    // Display ê°’ ID ë³€ê²½
                    ['Location', 'Project', 'Date', 'Type'].forEach(key => {
                        const display = wrapper.querySelector(`[id^="display${key}"]`);
                        if (display && display.id !== `display${key}`) {
                            display.id = `display${key}${newPageNum}`;
                        }
                    });
                    
                    // ë§ˆí‚¹ ìƒíƒœ ì´ë™
                    if (markingStates[oldPageNum]) {
                        markingStates[newPageNum] = markingStates[oldPageNum];
                        delete markingStates[oldPageNum];
                    }
                }
            });
            
            updatePageCounter();
        }
        
        function addPage() {
            if (pageCount >= MAX_PAGES) {
                alert(`ìµœëŒ€ ${MAX_PAGES}í˜ì´ì§€ê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                return;
            }
            
            pageCount++;
            const pageHTML = `
                <div class="card-wrapper" id="page${pageCount}Wrapper">
                    <button class="delete-page-btn" onclick="deletePage(${pageCount})">âœ•</button>
                    <div class="card" id="page${pageCount}Card">
                        <div class="card-header">
                            <div class="card-header-content">
                                <h1 class="card-title"> ë¶€ì‚° ì¬ê°œë°œÂ·ì¬ê±´ì¶• ê³ ì‹œ ê³µê³ </h1>
                            </div>
                        </div>
                        
                        <div class="card-body">
                            <div class="info-display">
                                <div class="info-row">
                                    <div class="info-row-label"> ì§€ì—­</div>
                                    <div class="info-row-value" id="displayLocation${pageCount}">ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-row-label"> ì‚¬ì—…ëª…</div>
                                    <div class="info-row-value" id="displayProject${pageCount}">ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-row-label"> ê³ ì‹œì¼</div>
                                    <div class="info-row-value" id="displayDate${pageCount}">2025ë…„ 11ì›” 16ì¼</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-row-label"> êµ¬ë¶„</div>
                                    <div class="info-row-value">
                                        <span class="highlight-box" id="displayType${pageCount}">ì¬ê°œë°œ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="page-item" id="page${pageCount}" data-page="${pageCount}">
                                <div class="page-header">
                                    <div class="page-title">
                                        <span>ğŸ“„</span>
                                        <span>ê³ ì‹œê³µê³ ë¬¸ ${pageCount}í˜ì´ì§€</span>
                                    </div>
                                    <div class="page-number">${pageCount} / ${pageCount}</div>
                                </div>
                                <div class="notice-image-container">
                                    <input type="file" class="image-input" id="imageInput${pageCount}" accept="image/*">
                                    <div class="image-upload-area" onclick="document.getElementById('imageInput${pageCount}').click()">
                                        <div class="upload-icon">ğŸ“„</div>
                                        <div class="upload-text">${pageCount}í˜ì´ì§€ ì´ë¯¸ì§€ ì²¨ë¶€</div>
                                        <div class="upload-subtext">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                                    </div>
                                    <div class="canvas-wrapper">
                                        <img class="notice-image">
                                        <canvas class="marking-canvas"></canvas>
                                    </div>
                                    <div class="marking-tools">
                                        <button class="tool-btn" onclick="showCropModal(${pageCount})">âœ‚ï¸ ìë¥´ê¸°</button>
                                        <div class="tool-divider"></div>
                                        <button class="tool-btn active" onclick="setTool(${pageCount}, 'select')" data-tool="select">ğŸ‘† ì„ íƒ</button>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'pen')" data-tool="pen">âœï¸ íœ</button>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'highlight')" data-tool="highlight">âœï¸ í˜•ê´‘íœ</button>
                                        <div class="thickness-dropdown">
                                            <button class="thickness-btn" onclick="toggleThickness(${pageCount})">
                                                ğŸ“ êµµê¸° <span id="thicknessLabel${pageCount}">ë³´í†µ</span>
                                            </button>
                                            <div class="thickness-menu" id="thicknessMenu${pageCount}">
                                                <div class="thickness-option" data-thickness="thin" onclick="setThickness(${pageCount}, 'thin', 'ì–‡ê²Œ')">
                                                    <div class="thickness-preview"></div>
                                                    <span>ì–‡ê²Œ</span>
                                                </div>
                                                <div class="thickness-option selected" data-thickness="normal" onclick="setThickness(${pageCount}, 'normal', 'ë³´í†µ')">
                                                    <div class="thickness-preview"></div>
                                                    <span>ë³´í†µ</span>
                                                </div>
                                                <div class="thickness-option" data-thickness="thick" onclick="setThickness(${pageCount}, 'thick', 'êµµê²Œ')">
                                                    <div class="thickness-preview"></div>
                                                    <span>êµµê²Œ</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'circle')" data-tool="circle">â­• ë™ê·¸ë¼ë¯¸</button>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'arrow')" data-tool="arrow">â¡ï¸ í™”ì‚´í‘œ</button>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'rect')" data-tool="rect">â–­ ì‚¬ê°í˜•</button>
                                        <button class="tool-btn" onclick="setTool(${pageCount}, 'map')" data-tool="map">ğŸ—ºï¸ ì§€ë„</button>
                                        <div class="tool-divider"></div>
                                        <input type="color" class="color-picker" value="#ffff00" onchange="setColor(${pageCount}, this.value)">
                                        <button class="tool-btn" onclick="deleteSelected(${pageCount})">ğŸ—‘ï¸ ì‚­ì œ</button>
                                        <button class="tool-btn" onclick="clearMarks(${pageCount})">ğŸ—‘ï¸ ì „ì²´ì‚­ì œ</button>
                                    </div>
                                    <button class="remove-image-btn" onclick="removeImage(${pageCount})">âœ•</button>
                                </div>
                            </div>
                            
                            <div class="footer">
                                <div class="footer-source"> ì¶œì²˜: @Chok.sense1</div>
                                <div class="footer-watermark">ë¶€ì‚° ì¬ê°œë°œÂ·ì¬ê±´ì¶• ì‹ ì† ì•Œë¦¼</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('additionalPages').insertAdjacentHTML('beforeend', pageHTML);
            setupPage(pageCount);
            updateDisplayValues(pageCount);
            updatePageCounter();
        }
        
        function updatePageCounter() {
            document.getElementById('pageCount').textContent = pageCount;
            const page1Number = document.querySelector('#page1 .page-number');
            if (page1Number) {
                page1Number.textContent = `1 / ${pageCount}`;
            }
        }
        
        async function saveAllPages() {
            const controlPanel = document.querySelector('.control-panel');
            const removeButtons = document.querySelectorAll('.remove-image-btn');
            const uploadAreas = document.querySelectorAll('.image-upload-area');
            const pageHeaders = document.querySelectorAll('.page-header');
            const markingTools = document.querySelectorAll('.marking-tools');
            const deletePageBtns = document.querySelectorAll('.delete-page-btn');
            
            controlPanel.style.display = 'none';
            removeButtons.forEach(btn => btn.style.display = 'none');
            uploadAreas.forEach(area => area.style.display = 'none');
            pageHeaders.forEach(header => header.style.display = 'none');
            markingTools.forEach(tool => tool.style.display = 'none');
            deletePageBtns.forEach(btn => btn.style.display = 'none');
            
            try {
                let savedCount = 0;
                const allWrappers = document.querySelectorAll('.card-wrapper');
                
                for (let i = 0; i < allWrappers.length; i++) {
                    const wrapper = allWrappers[i];
                    const pageNum = i + 1;
                    const card = wrapper.querySelector('.card');
                    const pageItem = wrapper.querySelector('.page-item');
                    
                    if (!pageItem || !pageItem.classList.contains('has-image')) {
                        if (pageNum === 1) {
                            alert('1í˜ì´ì§€ì— ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì²¨ë¶€í•´ì£¼ì„¸ìš”.');
                            break;
                        }
                        continue;
                    }
                    
                    if (card) {
                        await new Promise((resolve) => {
                            setTimeout(async () => {
                                const canvas = await html2canvas(card, {
                                    backgroundColor: '#ffffff',
                                    scale: 3,
                                    useCORS: true,
                                    allowTaint: false,
                                    logging: false
                                });
                                
                                const link = document.createElement('a');
                                const location = document.getElementById('locationInput').value || 'ë¶€ì‚°';
                                const project = document.getElementById('projectInput').value || 'ì¬ê°œë°œ';
                                const now = new Date();
                                const dateStr = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}`;
                                
                                link.download = `${location}_${project}_${pageNum}í˜ì´ì§€_${dateStr}.png`;
                                link.href = canvas.toDataURL('image/png', 1.0);
                                link.click();
                                savedCount++;
                                
                                resolve();
                            }, 500 * (i + 1));
                        });
                    }
                }
                
                if (savedCount > 0) {
                    alert(`ì´ ${savedCount}ê°œ í˜ì´ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                }
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
            
            controlPanel.style.display = 'block';
            uploadAreas.forEach(area => {
                const pageItem = area.closest('.page-item');
                if (!pageItem || !pageItem.classList.contains('has-image')) {
                    area.style.display = 'flex';
                }
            });
            pageHeaders.forEach(header => header.style.display = 'flex');
            markingTools.forEach(tool => {
                const pageItem = tool.closest('.page-item');
                if (pageItem && pageItem.classList.contains('has-image')) {
                    tool.style.display = 'flex';
                }
            });
            removeButtons.forEach(btn => {
                const pageItem = btn.closest('.page-item');
                if (pageItem && pageItem.classList.contains('has-image')) {
                    btn.style.display = 'flex';
                }
            });
            deletePageBtns.forEach(btn => btn.style.display = 'flex');
            
            // ì²« í˜ì´ì§€ ì‚­ì œ ë²„íŠ¼ë§Œ ìˆ¨ê¹€
            const firstDeleteBtn = document.querySelector('#page1Wrapper .delete-page-btn');
            if (firstDeleteBtn) firstDeleteBtn.style.display = 'none';
        }
        
        function resetAll() {
            if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('locationInput').value = 'ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬';
                document.getElementById('projectInput').value = 'ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…';
                document.getElementById('dateInput').value = '2025ë…„ 11ì›” 16ì¼';
                document.getElementById('typeInput').value = 'ì¬ê°œë°œ';
                
                document.getElementById('displayLocation').textContent = 'ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬';
                document.getElementById('displayProject').textContent = 'ê´‘ì•ˆ6êµ¬ì—­ ì¬ê°œë°œì‚¬ì—…';
                document.getElementById('displayDate').textContent = '2025ë…„ 11ì›” 16ì¼';
                document.getElementById('displayType').textContent = 'ì¬ê°œë°œ';
                
                const allWrappers = document.querySelectorAll('.card-wrapper');
                allWrappers.forEach((wrapper, index) => {
                    if (index === 0) {
                        removeImage(1);
                    } else {
                        wrapper.remove();
                    }
                });
                
                pageCount = 1;
                markingStates = {1: markingStates[1]};
                updatePageCounter();
                
                localStorage.clear();
            }
        }
        
        function loadSavedData() {
            const savedData = {
                locationInput: localStorage.getItem('locationInput'),
                projectInput: localStorage.getItem('projectInput'),
                dateInput: localStorage.getItem('dateInput'),
                typeInput: localStorage.getItem('typeInput')
            };
            
            if (savedData.locationInput) {
                document.getElementById('locationInput').value = savedData.locationInput;
                document.getElementById('displayLocation').textContent = savedData.locationInput;
            }
            if (savedData.projectInput) {
                document.getElementById('projectInput').value = savedData.projectInput;
                document.getElementById('displayProject').textContent = savedData.projectInput;
            }
            if (savedData.dateInput) {
                document.getElementById('dateInput').value = savedData.dateInput;
                document.getElementById('displayDate').textContent = savedData.dateInput;
            }
            if (savedData.typeInput) {
                document.getElementById('typeInput').value = savedData.typeInput;
                document.getElementById('displayType').textContent = savedData.typeInput;
            }
        }
    </script>
</body>
</html>
